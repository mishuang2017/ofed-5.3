From: Valentine Fatiev <valentinef@mellanox.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/en_rep.h

Change-Id: I550c1e7a80d3e16381301c23217dcd5c266c10df
---
 .../net/ethernet/mellanox/mlx5/core/en_rep.h  | 31 ++++++++++++++++++-
 1 file changed, 30 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
index xxxxxxx..xxxxxxx 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.h
@@ -94,6 +94,10 @@ struct mlx5_rep_uplink_priv {
 
 	/* support eswitch vports bonding */
 	struct mlx5e_rep_bond *bond;
+#ifndef HAVE_FLOW_INDR_DEV_REGISTER
+	struct notifier_block       netdevice_nb;
+	struct netdev_net_notifier  netdevice_nn;
+#endif
 };
 
 struct mlx5e_rep_priv {
@@ -270,7 +274,29 @@ static inline bool mlx5e_eswitch_rep(struct net_device *netdev)
 	       mlx5e_eswitch_uplink_rep(netdev);
 }
 
+#ifdef HAVE_DEVLINK_PORT_ATTRS_PCI_PF_SET
 struct devlink_port *mlx5e_rep_get_devlink_port(struct net_device *dev);
+#else
+static inline struct devlink_port *mlx5e_rep_get_devlink_port(struct net_device *dev)
+{
+	return NULL;
+}
+#endif
+
+#ifndef HAVE_DEVLINK_PORT_ATTRS_PCI_PF_SET
+int mlx5e_rep_get_phys_port_name(struct net_device *dev,
+				 char *buf, size_t len);
+#endif
+
+#if defined(HAVE_NDO_GET_PORT_PARENT_ID) || defined(HAVE_SWITCHDEV_OPS) || defined(HAVE_SWITCHDEV_H_COMPAT)
+#ifdef HAVE_DEVLINK_PORT_ATTRS_PCI_PF_SET
+void
+#else
+int
+#endif
+mlx5e_rep_get_port_parent_id(struct net_device *dev,
+			     struct netdev_phys_item_id *ppid);
+#endif
 
 #else /* CONFIG_MLX5_ESWITCH */
 static inline bool mlx5e_is_uplink_rep(const struct mlx5e_priv *priv) { return false; }
@@ -287,7 +313,10 @@ static inline bool mlx5e_eswitch_vf_rep(struct net_device *netdev) { return fals
 static inline void mlx5e_remove_sqs_fwd_rules(struct mlx5e_priv *priv) {}
 static inline struct devlink_port *mlx5e_rep_get_devlink_port(struct net_device *dev)
 { return NULL; }
-
+#ifndef HAVE_DEVLINK_PORT_ATTRS_PCI_PF_SET
+static inline int mlx5e_rep_get_phys_port_name(struct net_device *dev,
+					       char *buf, size_t len) { return 0; }
+#endif
 #endif
 
 static inline bool mlx5e_is_vport_rep(const struct mlx5e_priv *priv)
